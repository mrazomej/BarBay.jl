<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>utils · BarBay</title><meta name="title" content="utils · BarBay"/><meta property="og:title" content="utils · BarBay"/><meta property="twitter:title" content="utils · BarBay"/><meta name="description" content="Documentation for BarBay."/><meta property="og:description" content="Documentation for BarBay."/><meta property="twitter:description" content="Documentation for BarBay."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="BarBay logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">BarBay</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">BarBay</a></li><li><a class="tocitem" href="../contributing/">contributing</a></li><li><a class="tocitem" href="../examples/">examples</a></li><li><a class="tocitem" href="../math/">math</a></li><li><a class="tocitem" href="../mcmc/">mcmc</a></li><li><a class="tocitem" href="../model/">model</a></li><li><a class="tocitem" href="../stats/">stats</a></li><li class="is-active"><a class="tocitem" href>utils</a></li><li><a class="tocitem" href="../vi/">vi</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>utils</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>utils</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mrazomej/BarBay.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mrazomej/BarBay.jl/blob/main/docs/src/utils.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="utils"><a class="docs-heading-anchor" href="#utils">utils</a><a id="utils-1"></a><a class="docs-heading-anchor-permalink" href="#utils" title="Permalink"></a></h1><p>The <code>utils</code> module contains useful functions to handle the raw data and the output results.</p><p>The <code>data_to_arrays</code> function takes the tidy dataframes and converts it into the set of arrays used as input for all the models in the <a href="../model/#model">model</a> module. This function has different options to build the slight variations needed for each of the models.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BarBay.utils.data_to_arrays" href="#BarBay.utils.data_to_arrays"><code>BarBay.utils.data_to_arrays</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>data_to_arrays(data; kwargs)</code></p><p>Function to preprocess the tidy dataframe <code>data</code> into the corresponding inputs for the models in the <code>model</code> submodule.</p><p><strong>Arguments</strong></p><ul><li><code>data::DataFrames.AbstractDataFrame</code>: Tidy dataframe with the data to be used for sampling the model posterior distribution. </li></ul><p><strong>Optional Keyword Arguments</strong></p><ul><li><code>id_col::Symbol=:barcode</code>: Name of the column in <code>data</code> containing the barcode   identifier. The column may include any type of entry.</li><li><code>time_col::Symbol=:time</code>: Name of the column in <code>data</code> defining the time point at which measurements were done. The column may contain any type of entry as long as <code>sort</code> will result in time-ordered names.</li><li><code>count_col::Symbol=:count</code>: Name of the column in <code>data</code> containing the raw barcode count. The column must contain entries of type <code>Int64</code>.</li><li><code>neutral_col::Symbol=:neutral</code>: Name of the column in <code>data</code> defining whether the barcode belongs to a neutral lineage. The column must contain entries of type <code>Bool</code>.</li><li><code>rep_col::Union{Nothing,Symbol}=nothing</code>: Column indicating the experimental replicate each measurement belongs to. Default is <code>nothing</code>.</li><li><code>env_col::Union{Nothing,Symbol}=nothing</code>: Column indicating the environment in which each measurement was performed. Default is <code>nothing</code>.</li><li><code>genotype_col::Union{Nothing,Symbol}=nothing</code>: Column indicating the genotype each barcode belongs to when fitting a hierarchical model on genotypes. Default is <code>nothing</code>.</li><li><code>rm_T0::Bool=false</code>: Optional argument to remove the first time point from the inference. The data from this first time point is commonly of much lower quality. Therefore, removing this first time point might result in a better inference.</li><li><code>verbose::Bool=true</code>: Boolean indicating if printing statements should be made.</li></ul><p><strong>Returns</strong></p><ul><li><code>data_arrays::Dict</code>: Dictionary with the following elements:<ul><li><code>bc_ids</code>: List of barcode IDs in the order they are used for the inference.</li><li><code>neutral_ids</code>: List of neutral barcode IDs in the order they are used for the inference.</li><li><code>bc_count</code>: Count time series for each barcode. The options can be:<ul><li><code>Matrix{Int64}</code>: (n<em>time) × (n</em>bc) matrix with counts. Rows are time points, and columns are barcodes.</li><li><code>Array{Int64, 3}</code>: The same as the matrix, except the third dimension represents multiple experimental replicates.</li><li><code>Vector{Matrix{Int64}}</code>: List of matrices, one for each experimental replicate. This is when replicates have a different number of time points.</li></ul></li><li><code>bc_total</code>: Total number of barcodes per time point. The options can be:<ul><li><code>Vector{Int64}</code>: Equivalent to summing each matrix row.</li><li><code>Matrix{Int64}</code>: Equivalent to summing each row of each slice of the tensor.</li><li><code>Vector{Vector{Int64}}</code>: Equivalent to summing each matrix row.</li></ul></li><li><code>n_rep</code>: Number of experimental replicates.</li><li><code>n_time</code>: Number of time points. The options can be:<ul><li><code>Int64</code>: Number of time points on a single replicate or multiple replicates.</li><li><code>Vector{Int64}</code>: Number of time points per replicate when replicates have different lengths.</li></ul></li><li><code>envs</code>: List of environments. The options can be:<ul><li><code>String</code>: Single placeholder <code>env1</code></li><li><code>Vector{&lt;:Any}</code>: Environments in the order they were measured.</li><li><code>vector{Vector{&lt;:Any}}</code>: Environments per replicate when replicates have a different number of time points.</li></ul></li><li><code>n_env</code>: Number of environmental conditions.</li><li><code>genotypes</code>: List of genotypes for each of the non-neutral barcodes. The options can be:<ul><li><code>N/A</code>: String when no genotype information is given.</li><li><code>Vector{&lt;:Any}</code>: Vector of the corresponding genotype for each of the non-neutral barcodes in the order they are used for the inference.</li></ul></li><li><code>n_geno</code>: Number of genotypes. When no genotype information is provided, this defaults to zero.</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mrazomej/BarBay.jl/blob/3c9a2740f7e5c7fcbffe3a5a4fe7ca59b17902c5/src/utils.jl#L13-L86">source</a></section></article><p>The <code>advi_to_df</code> function takes the output when fitting a model performing variational inference <strong>using the mean-field approximation</strong>, i.e., assuming a diagonal covariance matrix.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="BarBay.utils.advi_to_df" href="#BarBay.utils.advi_to_df"><code>BarBay.utils.advi_to_df</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>advi_to_df(data::DataFrames.AbstractDataFrame, dist::Distribution.Sampleable,            vars::Vector{&lt;:Any}; kwargs)</code></p><p>Convert the output of automatic differentiation variational inference (ADVI) to a tidy dataframe.</p><p><strong>Arguments</strong></p><ul><li><code>data::DataFrames.AbstractDataFrame</code>: Tidy dataframe used to perform the ADVI inference. See <code>BarBay.vi</code> module for the dataframe requirements.</li><li><code>dist::Distributions.Sampleable</code>: The ADVI posterior sampleable distribution object.</li><li><code>vars::Vector{&lt;:Any}</code>: Vector of variable/parameter names from the ADVI run. </li></ul><p><strong>Optional Keyword Arguments</strong></p><ul><li><code>id_col::Symbol=:barcode</code>: Name of the column in <code>data</code> containing the barcode   identifier. The column may contain any type of entry.</li><li><code>time_col::Symbol=:time</code>: Name of the column in <code>data</code> defining the time point at which measurements were done. The column may contain any type of entry as long as <code>sort</code> will resulted in time-ordered names.</li><li><code>count_col::Symbol=:count</code>: Name of the column in <code>data</code> containing the raw barcode count. The column must contain entries of type <code>Int64</code>.</li><li><code>neutral_col::Symbol=:neutral</code>: Name of the column in <code>data</code> defining whether the barcode belongs to a neutral lineage or not. The column must contain entries of type <code>Bool</code>.</li><li><code>rm_T0::Bool=false</code>: Optional argument to remove the first time point from the inference. The data from this first time point is commonly of much lower quality. Therefore, removing this first time point might result in a better inference.</li><li><code>n_samples::Int=10_000</code>: Number of posterior samples to draw used for hierarchical models. Default is 10,000.</li></ul><p><strong>Returns</strong></p><ul><li><code>df::DataFrames.DataFrame</code>: DataFrame containing summary statistics of</li></ul><p>posterior samples for each parameter. Columns include:     - <code>mean, std</code>: posterior mean and standard deviation for each variable.     - <code>varname</code>: parameter name from the ADVI posterior distribution.     - <code>vartype</code>: Description of the type of parameter. The types are:         - <code>pop_mean_fitness</code>: Population mean fitness value <code>s̲ₜ</code>.         - <code>pop_std</code>: (Nuisance parameter) Log of standard deviation in the           likelihood function for the neutral lineages.         - <code>bc_fitness</code>: Mutant relative fitness <code>s⁽ᵐ⁾</code>.         - <code>bc_hyperfitness</code>: For hierarchical models, mutant hyperparameter           that connects the fitness over multiple experimental replicates or           multiple genotypes <code>θ⁽ᵐ⁾</code>.         - <code>bc_noncenter</code>: (Nuisance parameter) For hierarchical models,           non-centered samples used to connect the experimental replicates to           the hyperparameter <code>θ̃⁽ᵐ⁾</code>.         - <code>bc_deviations</code>: (Nuisance parameter) For hierarchical models,           samples that define the log of the deviation from the hyperparameter           fitness value <code>logτ⁽ᵐ⁾</code>.         - <code>bc_std</code>: (Nuisance parameter) Log of standard deviation in the           likelihood function for the mutant lineages.         - <code>freq</code>: (Nuisance parameter) Log of the Poisson parameter used to           define the frequency of each lineage.     - rep: Experimental replicate number.     - env: Environment for each parameter.     - id: Mutant or neutral strain ID.</p><p><strong>Notes</strong></p><ul><li>Converts multivariate posterior into summarized dataframe format.</li><li>Adds metadata like parameter type, replicate, strain ID, etc.</li><li>Can handle models with multiple replicates and environments.</li><li>Can handle models with hierarchical structure on genotypes.</li><li>Useful for post-processing ADVI results for further analysis and plotting.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mrazomej/BarBay.jl/blob/3c9a2740f7e5c7fcbffe3a5a4fe7ca59b17902c5/src/utils.jl#L406-L471">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../stats/">« stats</a><a class="docs-footer-nextpage" href="../vi/">vi »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 28 December 2023 20:47">Thursday 28 December 2023</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
